{% load questionnaire_entry_tags %}
<div class="table-responsive">
    <table class="table table-hover table-striped table-bordered" id="grid-table">
        <thead>
        {% if a_group.has_subgroups %}
            <tr>
                <th rowspan="2" class="qn-no">Q NO</th>
                {% for order in a_group.question_orders %}
                    {% if order.question.is_in_subgroup and order.question.is_first_in_group %}
                        <th colspan="{{ order.question.group.all_questions.count }}">
                            {{ order.question.group.name }}
                            {% if order.question.group.instructions %}
                                <hr/>
                                <a class="indent" data-toggle="popover" data-html="true" data-placement="bottom"
                                   data-trigger="hover"
                                   data-content="{{ order.question.group.instructions | safe }}">
                                    <i class="glyphicon glyphicon-info-sign cyan"></i> instructions</a>
                            {% endif %}
                        </th>
                    {% endif %}
                    {% if not order.question.is_in_subgroup %}
                        <th rowspan="2">{{ order.question.text }}
                            {% if order.question.instructions %}
                                <hr/>
                                <a class="indent" data-toggle="popover" data-html="true" data-placement="bottom"
                                   data-trigger="hover"
                                   data-content="{{ order.question.instructions | safe }}">
                                    <i class="glyphicon glyphicon-info-sign cyan"></i> instructions</a>
                            {% endif %}

                        </th>
                    {% endif %}
                {% endfor %}
            </tr>
            <tr>
                {% for order in a_group.question_orders %}
                    {% if  order.question.is_in_subgroup %}
                        <th>{{ order.question.text }}</th>
                    {% endif %}
                {% endfor %}
            </tr>
        {% else %}
            <tr>
                <th rowspan="2">Q NO</th>
                {% for order in a_group.question_orders %}
                    <th>{{ order.question.text }}</th>
                {% endfor %}
            </tr>
        {% endif %}

        </thead>
        <tbody>
        {% for order in a_group.question_orders %}
            {% if  order.question.is_primary %}
                {% for option in order.question.options.all %}
                    <tr>
                    <td>
                        <div class="question-number">
                        {{ section.order }}{% if section.has_at_least_two_subsections %}.{{ subsection.order }}{% endif %}.{% if subsection.has_at_least_two_groups %}{{ group.order }}.{% endif %}{% if group.has_at_least_two_questions %}{{ forloop.counter }}{% endif %}
                        </div>
                    </td>
                    {% for field in order.question|get_form:formsets %}
                        <td>{{ field }}</td>
                    {% endfor %}
                    {% for question in a_group.all_non_primary_questions %}
                        {% for field in question|get_form:formsets %}
                            <td>
                                {% if field.errors %}
                                    <div class="field-error grid-error" data-toggle="popover" data-html="true"
                                         data-placement="right" data-trigger="hover"
                                         data-content="{{ field.errors|striptags }}">

                                {% endif %}
                                {{ field }}
                                {% if field.errors %}
                                    </div>
                                {% endif %}

                            </td>
                        {% endfor %}
                    {% endfor %}
                {% endfor %}
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>